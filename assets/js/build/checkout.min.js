jQuery(function(a){if("undefined"==typeof _MASTERIYO_CHECKOUT_)return!1;var n={$form:a("form.masteriyo-checkout"),getAjaxURL:function(){return _MASTERIYO_CHECKOUT_.ajaxURL},getCheckoutURL:function(){return _MASTERIYO_CHECKOUT_.checkoutURL},init:function(){a(document.body).on("update_checkout",this.updateCheckout),a(document.body).on("init_checkout",this.initCheckout),this.$form.on("click",'input[name="payment_method"]',this.paymentMethodSelected),this.$form.attr("novalidate","novalidate"),this.$form.on("submit",this.submit),this.initPaymentMethods(),!0===_MASTERIYO_CHECKOUT_.is_checkout&&a(document.body).trigger("initCheckout"),a("#masteriyo-checkout-attachment-upload").on("change",function(e){e=e.target.files[0];e&&(a("#masteriyo-checkout-attachment-upload-file-name").text(e.name),a("#masteriyo-checkout-attachment-uploaded-file-info").css({display:"flex",gap:"10px","align-items":"center"}).show(),a("#masteriyo-checkout-attachment-upload").hide())}),a("#masteriyo-checkout-attachment-uploaded-delete-file").on("click",function(){a("#masteriyo-checkout-attachment-upload").val("").show(),a("#masteriyo-checkout-attachment-upload-file-name").text(""),a("#masteriyo-checkout-attachment-uploaded-file-info").hide()})},initPaymentMethods:function(){var e=this.$form.find('input[name="payment_method"]'),t=(1===e.length&&e.eq(0).hide(),n.selectedPaymentMethod&&a("#"+n.selectedPaymentMethod).prop("checked",!0),0===e.filter(":checked").length&&e.eq(0).prop("checked",!0),e.filter(":checked").eq(0).prop("id"));1<e.length&&a('div.payment-box:not(".'+t+'")').filter(":visible").slideUp(0),e.filter(":checked").eq(0).trigger("click")},attachUnloadEventsOnSubmit:function(){a(window).on("beforeunload",this.handleUnloadEvent)},getPaymentMethod:function(){return this.$form.find('input[name="payment_method"]:checked').val()},paymentMethodSelected:function(e){e.stopPropagation(),1<a(".payment-methods input.input-radio").length?(e=a("div.payment-box."+a(this).attr("ID")),(t=a(this).is(":checked"))&&!e.is(":visible")&&(a("div.payment-box").filter(":visible").slideUp(230),t)&&e.slideDown(230)):a("div.payment-box").show(),a(this).data("order_button_text")?a("#masteriyo-place-order").text(a(this).data("order_button_text")):a("#masteriyo-place-order").text(a("#masteriyo-place-order").data("value"));var t=a('.masteriyo-checkout input[name="payment_method"]:checked').attr("id");t!==this.selectedPaymentMethod&&a(document.body).trigger("paymentMethodSelected"),this.selectedPaymentMethod=t},initCheckout:function(){a(document.body).trigger("update_checkout")},resetUpdateCheckoutTimer:function(){clearTimeout(n.updateTimer)},isValidJson:function(e){try{var t=JSON.parse(e);return t&&"object"==typeof t}catch(e){return!1}},updateCheckout:function(e,t){n.resetUpdateCheckoutTimer(),n.updateTimer=setTimeout(n.updateCheckoutAction,"5",t)},handleUnloadEvent:function(e){if(-1===navigator.userAgent.indexOf("MSIE")&&!document.documentMode)return!0;e.preventDefault()},detachUnloadEventsOnSubmit:function(){a(window).off("beforeunload",this.handleUnloadEvent)},submitError:function(e){a(".masteriyo-NoticeGroup-checkout, .masteriyo-error, .masteriyo-message").remove(),n.$form.prepend('<div class="masteriyo-NoticeGroup masteriyo-NoticeGroup-checkout">'+e+"</div>"),n.$form.find(".input-text, select, input:checkbox").trigger("validate").trigger("blur"),n.scrollToNotices(),a(document.body).trigger("checkout_error",[e])},scrollToNotices:function(){var e=a(".masteriyo-NoticeGroup-updateOrderReview, .masteriyo-NoticeGroup-checkout");(e=e.length?e:a("form.masteriyo-checkout")).length&&a("html, body").animate({scrollTop:e.offset().top-100},1e3)},handleFormSubmissionFailure:function(e,t,o){n.detachUnloadEventsOnSubmit();try{error=e.responseJSON,n.submitError('<div class="masteriyo-error">'+error.data.messages+"</div>")}catch(e){console.log(e)}},handleFormSubmissionSuccess:function(t,e,o){n.detachUnloadEventsOnSubmit();try{if("success"!==t.result||!1===n.$form.triggerHandler("checkout_place_order_success",t))throw"failure"===t.result?"Result failure":"Invalid response";-1===t.redirect.indexOf("https://")||-1===t.redirect.indexOf("http://")?window.location=t.redirect:window.location=decodeURI(t.redirect)}catch(e){!0===t.reload?window.location.reload():(!0===t.refresh&&a(document.body).trigger("update_checkout"),t.messages&&n.submitError(t.messages))}},submit:function(e){var t;return console.log("Checkout form submission"),n.$form.is(".processing")||!1!==n.$form.triggerHandler("checkout_place_order")&&!1!==n.$form.triggerHandler("checkout_place_order_"+n.getPaymentMethod())&&(n.attachUnloadEventsOnSubmit(),t=new FormData(n.$form[0]),a.ajax({type:"POST",url:n.getCheckoutURL(),dataType:"json",data:t,processData:!1,contentType:!1,beforeSend:function(e){n.$form.addClass("processing").block({message:'<span class="spinner" style="visibility:visible"></span>',css:{border:"",width:"0%"},overlayCSS:{background:"#fff",opacity:.6}})},success:function(e,t,o){n.handleFormSubmissionSuccess(e,t,o)},error:function(e,t,o){n.handleFormSubmissionFailure(e,t,o)},complete:function(e,t){n.detachUnloadEventsOnSubmit(),n.$form.removeClass("processing").unblock()}})),!1}};n.init(),a.each(_MASTERIYO_CHECKOUT_.countries,function(e,t){a("#billing-county").append(a("<option>",{value:e,text:t}))}),a("#billing-county").on("change",function(){var o=a("#billing-state"),e=o.parent(".masteriyo-checkout----state"),t=a(this).val(),n=_MASTERIYO_CHECKOUT_.countries,i=_MASTERIYO_CHECKOUT_.states;n&&i&&(n[t]?(n=i[t])?(o.empty(),o.append(a("<option>",{value:"",text:"Select state"})),a.each(n,function(e,t){o.append(a("<option>",{value:e,text:t}))}),e.show()):e.hide():o.html('<option value="">Select state</option>'))})});